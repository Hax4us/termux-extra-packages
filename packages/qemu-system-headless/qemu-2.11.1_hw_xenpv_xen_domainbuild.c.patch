diff -uNr qemu-2.11.1/hw/xenpv/xen_domainbuild.c qemu-2.11.1.mod/hw/xenpv/xen_domainbuild.c
--- qemu-2.11.1/hw/xenpv/xen_domainbuild.c	2018-02-14 23:53:22.000000000 +0200
+++ qemu-2.11.1.mod/hw/xenpv/xen_domainbuild.c	2018-06-24 01:51:36.985796945 +0300
@@ -166,7 +166,7 @@
 
     /* close all file handles, except stdio/out/err,
      * our watch pipe and the xen interface handle */
-    n = getdtablesize();
+    n = sysconf(_SC_OPEN_MAX);
     for (i = 3; i < n; i++) {
         if (i == fd[0])
             continue;
